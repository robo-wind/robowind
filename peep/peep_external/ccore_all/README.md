# SDK
This repo contains CommuniCore C and C++ SDKs and various network 
services, such as hub, WebSocket proxy and stats collector.

For general information about CommuniCore, please see the 
[wiki](https://gitlab.wdi.disney.com/communicore/ccore_all/wikis).

## BSON libraries

CommuniCore SDK for C++ can utilize one of two BSON encoding libraries, 
MongoDB's [libbson](http://mongoc.org/libbson/current/index.html) or Robowind's 
[ccore_bson]
Due to much friendlier systanx, ccore_bson is recommended. 

For C SDK, only libbson is supported, due to ccore_bson's dependency on C++.


## Installing SDK

### Binary Libraries

Binary versions of libraries are avaiable on [Nexus](https://nexus.wdi.cloud/content/repositories/ccore-releases/native/).
Linux libraries support Centos 5 (released in 2005) and later. Mac OSX libraries
support Meverics 10.9 (released in 2013) and later.

To use binary libraries, unpack them in CCORE_DIR (for example
`/usr/local/ccore`). Compile you application:
```shell
c++  -std=c++11 -I $CCORE_DIR/include $CCORE_DIR/lib/libccore.a $CCORE_DIR/lib/libczmq.a $CCORE_DIR/lib/libzmq.a test.cpp -o test
```

Alternatively, you can also compile against dynamic libraries
```shell
c++  -std=c++11 -I $CCORE_DIR/include -L$CCORE_DIR/lib -lccore test.cpp -o test
```

If you installed CommuniCore libraries in `/usr/local`, you can shorten that
to
```shell
c++  -std=c++11 -lccore test.cpp -o test
```

Due to number of different variants of Windows static libraries, they are not
provided in binary form. However, Visual Studio project files are included
for simplified source build.


### Building from source

#### Build systems
CommuniCore native libraries support two build systems, 
[CMake](https://cmake.org/) and [gyp](https://gyp.gsrc.io/).

#### Building with Visual Studio

Visual Studio files (generated by gyp) are in [gyp](ccore_lib/builds/gyp) directory.

#### Building with CMake

```shell
git clone git@gitlab-ssh.wdi.disney.com:communicore/libraries/ccore_all.git
cd ccore_all
mkdir build
cd build
```

If you would like to build with ccore_bson support (recommended):

```shell
cmake ..
make -j3
make install
```
Above command will install CommuniCore in `/usr/local`. Full list of installed 
files will be in `install_manifest.txt`.

If you would like to install in a different directory, use the following
instead:
```shell

cmake -DCMAKE_INSTALL_PREFIX=/usr/local/ccore/ ..
make -j3
make install
```


If you require libbson support, use the following instead: 

```shell
cmake -DLIBBSON_SUPPORT=ON ..
make -j3
make install
```

If your current user does not have permission to write to `/usr/local`, you might
need to run
```shell
sudo make install
```

Integration of CommuniCore libraries in your project
will depend on your build system. For example integration into CMake
project, please see ccore_all/ccore_lib/example.

#### Building with GYP

Gyp allows for more source based integration between various subprojects. 
Instead of relying on headers and compiled libraries, gyp generates top level
project files that include source from all required projects.

##### Installing GYP 

Version of GYP is available inside of this repository at [tools/gyp](tools/gyp).
GYP requires Python 2.7 and does not work with Python 3+. To install it, run
```bash
sudo python setup.py install
``` 
inside of [tools/gyp](tools/gyp) directory


```shell
git clone git@gitlab-ssh.wdi.disney.com:communicore/libraries/ccore_all.git
cd ccore_all/ccore_lib/buids/gyp
```

Gyp supports make, XCode and Visual Studio configuration.

To generate and build using make (default on Linux)
```shell
gyp --depth="." --format=make project.gyp
make -j3
```
Artifacts will be produced in `out/Default` directory.


To generate and build using xcode (default on OSX)
```shell
gyp --depth="." --format=xcode project.gyp
make -j3
```
Artifacts will be produced in `build/Default` directory.


To generate project settings for Visual Studio (default on Windows)
```shell
gyp --depth="." --format=msvs project.gyp

```
To generate project settings for a specific verson of Visual Studio
```shell
gyp --depth="." --format=msvs  -G msvs_version=2015 project.gyp

```

To build 64bit Release build
```shell
msbuild /m:2 /p:Configuration=Release;Platform=x64 project.sln
```
Artifacts will be produced in `Release` directory.


To build 32bit Debug build
```shell
msbuild /m:2 /p:Configuration=Debug;Platform=Win32 project.sln
```
Artifacts will be produced in `Debug`  directory.


### Example projects

Example projects contain build settings for both CMake and gyp (in builds/gyp)
and usage examples.

#### C++
* [ccore_bson version](ccore_lib/example)
* [libbson version](ccore_cpp/example)

#### C
* [libbson version](ccore_c/example)



